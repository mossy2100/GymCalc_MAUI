@using GymCalc.Services
@inject NavigationManager NavigationManager
@inject HtmlUpdaterService HtmlUpdaterService

<Router AppAssembly="@typeof(Main).Assembly">
    <Found Context="routeData">
        <RouteView DefaultLayout="@typeof(MainLayout)" RouteData="@routeData" />
        <FocusOnNavigate RouteData="@routeData" Selector="h1" />
    </Found>
    <NotFound>
        <LayoutView Layout="@typeof(MainLayout)">
            <p role="alert">Sorry, there's nothing at this address.</p>
        </LayoutView>
    </NotFound>
</Router>

@code
{
    // The current route.
    private string _route;

    /// <inheritdoc />
    protected override void OnInitialized()
    {
        base.OnInitialized();

        // Set up the event handler for future navigations.
        HtmlUpdaterService.OnUpdate += GotoRoute;

        // Handle the initial navigation.
        GotoRoute();
    }

    private void GotoRoute()
    {
        if (!string.IsNullOrEmpty(HtmlUpdaterService.Route) &&
            HtmlUpdaterService.Route != _route)
        {
            // Go to the new route.
            NavigationManager.NavigateTo(HtmlUpdaterService.Route);

            // Remember it so we can test for changes.
            _route = HtmlUpdaterService.Route;
        }
    }
}
